<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <style>

.view {
  display: block;
  width: 240px;
  height: 240px;
  background-color: #eee;
  margin: 10px;
  overflow: visible;
}

.ll-path {
  fill: none;
  stroke: blue;
  stroke-width: 1px;
  marker-start: url("#m-start");
  marker-end: url("#m-end");
}

.start { fill: rgba(127, 205, 255, 0.8); }
.end { fill: rgba(255, 127, 205, 0.8); }
#mark > polygon { fill: rgba(255, 255, 255, 0.8); }

  </style>

</head>
<body>
  <svg version="1.1" width="0" height="0">
    <defs>
      <style type="text/css"><![CDATA[
        #grid {
          fill: none;
          stroke-width: 0.4px;
        }

        #grid1 { stroke: #999; stroke-dasharray: 1px; }
        #grid2 { stroke: #999; }
      ]]></style>
      <g id="grid">
        <path id="grid1" d="
          M0,0 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240
          m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240
          m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240
          m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240
          m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240 m-240,10 h240
          M0,0 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240
          m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240
          m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240
          m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240
          m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240 m10,-240 v240
          " />
        <path id="grid2" d="
          M0,0 h240 m-240,50 h240 m-240,50 h240 m-240,50 h240 m-240,50 h240
          M0,0 v240 m50,-240 v240 m50,-240 v240 m50,-240 v240 m50,-240 v240
          " />
      </g>
    </defs>
  </svg>
  <svg version="1.1" width="0" height="0">
    <defs>
      <g id="mark">
        <circle r="10" cx="0" cy="0" />
        <polygon id="arrow" points="-7,-7 10,0 -7,7 0,0" stroke-width="0"/>
      </g>
    </defs>
  </svg>

  <textarea id="code"></textarea>

<script src="test-make.js"></script>
<script src="../../src/path-data-polyfill.js"></script>
<script>

window.addEventListener('load', function() {
  var
    SOCKET_TOP = 1, SOCKET_RIGHT = 2, SOCKET_BOTTOM = 3, SOCKET_LEFT = 4,
    MIN_GRID_LEN = 30,

    SVG_NS = 'http://www.w3.org/2000/svg',

    INDENT = '    ',
    ID2VAR = {1: 'SOCKET_TOP', 2: 'SOCKET_RIGHT', 3: 'SOCKET_BOTTOM', 4: 'SOCKET_LEFT'},
    code = '',

    testCases = [
      {
        title: '1-1',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_TOP}
      },
      {
        title: '1-2 on axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 60 + MIN_GRID_LEN, socketId: SOCKET_TOP}
      },
      {
        title: '1-3 on axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + MIN_GRID_LEN, y: 210, socketId: SOCKET_TOP}
      },
      {
        title: '1-4 same coordinates',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + MIN_GRID_LEN, y: 60 + MIN_GRID_LEN, socketId: SOCKET_TOP}
      },
      {
        title: '2-1',
        startSocketXY: {x: 50, y: 210, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 60, socketId: SOCKET_TOP}
      },
      {
        title: '2-2 on axis',
        startSocketXY: {x: 50, y: 210, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + MIN_GRID_LEN, y: 60, socketId: SOCKET_TOP}
      },
      {
        title: '2-1 (close)',
        startSocketXY: {x: 50, y: 210, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 210 + MIN_GRID_LEN - 15, socketId: SOCKET_TOP}
      },
      {
        title: '2-2 (close)',
        startSocketXY: {x: 50, y: 210, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + MIN_GRID_LEN + 15, y: 210 + MIN_GRID_LEN - 15, socketId: SOCKET_TOP}
      },
      {
        title: '3',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_TOP},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_RIGHT}
      },
      {
        title: '3 (close)',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_TOP},
        endSocketXY: {x: 50 - MIN_GRID_LEN + 15, y: 60 - MIN_GRID_LEN + 15, socketId: SOCKET_RIGHT}
      },
      {
        title: '4-1',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '4-2 on axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 200, y: 60, socketId: SOCKET_LEFT}
      },
      {
        title: '4-3 on cross axis',
        startSocketXY: {x: 120 - MIN_GRID_LEN, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 120 + MIN_GRID_LEN, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '4-4 same coordinates',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + MIN_GRID_LEN * 2, y: 60, socketId: SOCKET_LEFT}
      },
      {
        title: '4-5 on cross axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 210, socketId: SOCKET_RIGHT}
      },
      {
        title: '4-6 same coordinates',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT}
      },
      {
        title: '5-1',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_LEFT},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '5-2 on axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_LEFT},
        endSocketXY: {x: 200, y: 60, socketId: SOCKET_LEFT}
      },
      {
        title: '5-1 (close 1)',
        startSocketXY: {x: 200 - MIN_GRID_LEN + 15, y: 60, socketId: SOCKET_LEFT},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '5-1 (close 2)',
        startSocketXY: {x: 200 - MIN_GRID_LEN + 15, y: 210 - 15, socketId: SOCKET_LEFT},
        endSocketXY: {x: 200, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '6-1',
        startSocketXY: {x: 200, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 210, socketId: SOCKET_LEFT}
      },
      {
        title: '6-2 on axis',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_LEFT},
        endSocketXY: {x: 200, y: 60, socketId: SOCKET_RIGHT}
      },
      {
        title: '6-1 (close 1)',
        startSocketXY: {x: 200, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 60 + MIN_GRID_LEN - 15, socketId: SOCKET_LEFT}
      },
      {
        title: '6-1 (close 2)',
        startSocketXY: {x: 50 - MIN_GRID_LEN + 15, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 60 + MIN_GRID_LEN - 15, socketId: SOCKET_LEFT}
      },
      {
        title: '6-1 (close 3)',
        startSocketXY: {x: 50 - MIN_GRID_LEN, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + 15, y: 60 + MIN_GRID_LEN - 15, socketId: SOCKET_LEFT}
      },
      {
        title: '6-1 (close 4)',
        startSocketXY: {x: 50 - MIN_GRID_LEN, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50 + 15, y: 60 - 15, socketId: SOCKET_LEFT}
      },
      {
        title: '7-1 same SocketGravity',
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-2 SocketGravity 50',
        startSocketGravity: 50,
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-3 SocketGravity -10',
        startSocketGravity: -10,
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-4 SocketGravity [50, 600]',
        startSocketGravity: [50, 600],
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-5 SocketGravity [-10, 600]',
        startSocketGravity: [-10, 600],
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-6 SocketGravity [0, 50]',
        startSocketGravity: [0, 50],
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-7 SocketGravity [0, -10]',
        startSocketGravity: [0, -10],
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-8 SocketGravity 0',
        startSocketGravity: 0,
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-9 SocketGravity [0, 0]',
        startSocketGravity: [0, 0],
        startSocketXY: {x: 50, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
      {
        title: '7-10 SocketGravity 0 on axis',
        startSocketGravity: 0,
        startSocketXY: {x: 50 + MIN_GRID_LEN, y: 60, socketId: SOCKET_RIGHT},
        endSocketXY: {x: 50, y: 75, socketId: SOCKET_RIGHT}
      },
    ];

  testCases.forEach(function(testCase) {
    var data = getGrid(testCase.startSocketXY, testCase.endSocketXY,
        testCase.startSocketGravity, testCase.endSocketGravity),
      svg, grid, path, head;

    svg = document.createElementNS(SVG_NS, 'svg');
    svg.className.baseVal = 'view';
    grid = svg.appendChild(document.createElementNS(SVG_NS, 'use'));
    grid.href.baseVal = '#grid';

    ['start', 'end'].forEach(function(key) {
      var socketXY = testCase[key + 'SocketXY'];
        socket = svg.appendChild(document.createElementNS(SVG_NS, 'use'));
      socket.className.baseVal = key;
      socket.href.baseVal = '#mark';
      socket.x.baseVal.value = socketXY.x;
      socket.y.baseVal.value = socketXY.y;
      socket.setAttribute('transform', 'rotate(' +
        ((socketXY.socketId - 2) * 90) + ', ' + socketXY.x + ', ' + socketXY.y + ')');
    });

    path = svg.appendChild(document.createElementNS(SVG_NS, 'path'));
    path.className.baseVal = 'll-path';
    path.setPathData(data.pathData);

    head = document.body.appendChild(document.createElement('h3'));
    head.textContent = testCase.title;

    document.body.appendChild(svg);

    code +=
      INDENT + '// ' + testCase.title + '\n' +
      INDENT + 'props = {\n' +
      INDENT + '  startSocketXY: {x: ' + testCase.startSocketXY.x +
        ', y: ' + testCase.startSocketXY.y + ', socketId: ' +
        ID2VAR[testCase.startSocketXY.socketId] + '},\n' +
      INDENT + '  endSocketXY: {x: ' + testCase.endSocketXY.x +
        ', y: ' + testCase.endSocketXY.y + ', socketId: ' +
        ID2VAR[testCase.endSocketXY.socketId] + '}\n' +
      INDENT + '};\n' +
      (testCase.startSocketGravity != null || testCase.endSocketGravity != null ?
        INDENT + 'options = {\n' +
          ['startSocketGravity', 'endSocketGravity']
            .filter(function(prop) { return testCase[prop] != null; })
            .map(function(prop) {
              return INDENT + '  ' + prop + ': ' +
                (Array.isArray(testCase[prop]) ? '[' + testCase[prop].join(', ') + ']' : testCase[prop]);
            }).join(',\n') +
          '\n' + INDENT + '};\n'
        : '') +
      INDENT + 'pathSegs = [];\n' +
      INDENT + 'func();\n' +
      INDENT + 'expect(pathSegs).toEqual([\n' +
        data.pathSegs.map(function(pathSeg) {
          return INDENT + '  [' + pathSeg.map(function(point) {
            return '{x: ' + point.x + ', y: ' + point.y + '}';
          }).join(', ') + ']';
        }).join(',\n') +
        '\n' + INDENT + ']);\n' +
      (testCase.startSocketGravity != null || testCase.endSocketGravity != null ?
        INDENT + 'options = {};\n' : '') +
      '\n';
  });

  document.getElementById('code').value = code;
}, false);

</script>

</body>
</html>
